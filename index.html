<html>
<head>
    <meta charset="utf-8">

    <script src="https://d3js.org/d3.v5.min.js"></script>
    
    <!-- Color scale -->
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

    <title>POS - data</title>
</head>

<body>
    <h1>Pos Data</h1>
    <button onclick="changeColor('Dairy')">Dairy</button>
    <button onclick="changeColor('Personal Care')">Personal Care</button>
    <button onclick="changeColor('Snack')">Snack</button>
    <button onclick="changeColor('House Cleaning')">House Cleaning</button>
    <button onclick="changeColor('General Food')">General Food</button>
    <button onclick="changeColor('Healthy Food')">Healthy Food</button>

    <div id='values_barchart'></div>
    <div id='units_barchart'></div>
    <!-- Add resources -->
    <!-- https://blog.risingstack.com/d3-js-tutorial-bar-charts-with-javascript/ -->
    <!-- https://www.d3-graph-gallery.com/graph/barplot_button_data_simple.html -->
    <!-- http://bl.ocks.org/jonahwilliams/2f16643b999ada7b1909-->
    <script>

      // chart size
      var margin = {top: 30, right: 30, bottom: 70, left: 60},
      width = 460 - margin.left - margin.right,
      height = 400 - margin.top - margin.bottom;

      // _______________
      // Values Barchart
      // _______________

      const values_svg = d3.select('#values_barchart')
        .append('svg')
          .attr('width', width + margin.left + margin.right)
          .attr('height', height + margin.top + margin.bottom)
        .append('g')
          .attr("transform",  "translate(" + margin.left + "," + margin.top + ")");
      
      // initialize promise
      var pos = d3.csv('average_basket.csv');
      pos.then(function (data) {
        console.log(data)

      // X axis
        var x = d3.scaleBand()
          .range([ 0, width ])
          .domain(data.map(function(d) { return d.cluster; }))
          .padding(0.2);
        values_svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x))
          .selectAll("text")
          .attr("transform", "translate(-10,0)rotate(-45)")
          .style("text-anchor", "end");

        // Y axis
        var y = d3.scaleLinear()
          .domain([0, 25])
          .range([height, 0]);
        values_svg.append("g")
          .call(d3.axisLeft(y));
        
        // Bars

        values_svg.selectAll('rect')
          .data(data)
          .enter()
          .append('rect')
            .attr('x', function(d) {return x(d.cluster); })
            .attr('y', function(d) {return y(d.avalue); })
            .attr('width', x.bandwidth())
            .attr('height', function(d) {return height - y(d.avalue); })
            .attr('fill', '#D3D3D3')

      // _______________
      // Units Barchart
      // _______________

      const units_svg = d3.select('#units_barchart')
        .append('svg')
          .attr('width', width + margin.left + margin.right)
          .attr('height', height + margin.top + margin.bottom)
        .append('g')
          .attr("transform",  "translate(" + margin.left + "," + margin.top + ")");

        // X axis

        var x = d3.scaleBand()
          .range([ 0, width ])
          .domain(data.map(function(d) { return d.cluster; }))
          .padding(0.2);
        units_svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x))
          .selectAll("text")
          .attr("transform", "translate(-10,0)rotate(-45)")
          .style("text-anchor", "end");

        // Y axis

        var y = d3.scaleLinear()
          .domain([0, 12])
          .range([height, 0]);
        units_svg.append("g")
          .call(d3.axisLeft(y));
        
        // Bars

        units_svg.selectAll('rect')
          .data(data)
          .enter()
          .append('rect')
            .attr('x', function(d) {return x(d.cluster); })
            .attr('y', function(d) {return y(d.aunits); })
            .attr('width', x.bandwidth())
            .attr('height', function(d) {return height - y(d.aunits); })
            .attr('fill', '#D3D3D3')


      });

    // This function is called by the buttons on top of the plot
    
    function changeColor(cluster) {

      d3.selectAll('rect')
        .style('fill', '#D3D3D3')

      d3.selectAll('rect')
        .filter(function(d) {return d.cluster == cluster; })
        .transition()
        .style('fill', 'blue')
  }
    </script>        
    
</body>
</html>
